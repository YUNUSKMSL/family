<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Ä°ÅŸ Takip - Ekip Sistemi</title>
<style>
    :root { --primary: #0066cc; }
    body { font-family: Arial, sans-serif; margin:0; background:#f4f4f4; }
    .container { max-width: 1100px; margin: auto; }
    header { background: var(--primary); color: white; padding: 15px; text-align: center; }
    .login { max-width: 400px; margin: 100px auto; background: white; padding: 40px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); text-align: center; }
    input, select, button { padding: 12px; margin: 10px 0; width: 100%; border-radius: 6px; border: 1px solid #ccc; font-size: 16px; }
    button { background: var(--primary); color: white; border: none; cursor: pointer; }
    button:hover { background: #0055aa; }
    .tab { display: flex; background: #ddd; }
    .tab button { flex:1; padding:15px; background:none; border:none; font-weight:bold; }
    .tab button.active { background:white; border-bottom:3px solid var(--primary); }
    .section { display:none; padding:20px; background:white; margin:10px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
    .section.active { display:block; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th, td { padding:12px; text-align:left; border-bottom:1px solid #ddd; }
    th { background:#f0f0f0; }
    .status-at { color:#0066cc; font-weight:bold; }
    .status-yap { color:#28a745; font-weight:bold; }
    .status-ert { color:#ffc107; font-weight:bold; }
    .status-rek { color:#dc3545; font-weight:bold; }
    .report-box { background:#f8f9fa; padding:20px; border-radius:8px; margin-top:20px; }
</style>
</head>
<body>

<header>
    <h1>ğŸ—ï¸ Ä°ÅŸ Takip Sistemi</h1>
</header>

<div id="loginScreen" class="login">
    <h2>Ekip Kodu ile GiriÅŸ</h2>
    <input type="text" id="teamCode" placeholder="Ekip Kodu (Ã¶rn: 06EVB104)" autofocus>
    <button onclick="login()">GiriÅŸ Yap</button>
</div>

<div id="app" style="display:none;">
    <div class="container">
        <div style="padding:15px; background:white; display:flex; justify-content:space-between; align-items:center;">
            <h2>Ekip: <span id="teamName" style="color:#0066cc;"></span></h2>
            <button onclick="logout()">Ã‡Ä±kÄ±ÅŸ</button>
        </div>

        <div class="tab">
            <button class="active" onclick="showTab(0)">Ä°ÅŸler</button>
            <button onclick="showTab(1)">Rapor</button>
        </div>

        <!-- Ä°ÅŸler Sekmesi -->
        <div id="tab0" class="section active">
            <h3>Yeni Ä°ÅŸ Ekle</h3>
            <select id="jobType">
                <option value="FTTH Kurulum">FTTH Kurulum</option>
                <option value="FTTH ArÄ±za">FTTH ArÄ±za</option>
                <option value="IPTV Kurulum">IPTV Kurulum</option>
                <option value="IPTV ArÄ±za">IPTV ArÄ±za</option>
                <option value="Ses Kurulum">Ses Kurulum</option>
                <option value="Ses ArÄ±za">Ses ArÄ±za</option>
                <option value="Harici">Harici</option>
            </select>
            <input type="date" id="jobDate">
            <button onclick="addJob()">Ä°ÅŸ Ekle</button>

            <h3 style="margin-top:30px;">Ä°ÅŸ Listesi</h3>
            <table id="jobsTable">
                <thead>
                    <tr>
                        <th>Tarih</th>
                        <th>Tip</th>
                        <th>Durum</th>
                        <th>Ä°ÅŸlem</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Rapor Sekmesi -->
        <div id="tab1" class="section">
            <h3>Rapor OluÅŸtur</h3>
            <input type="date" id="reportDate">
            <button onclick="generateReport()">Rapor GÃ¶ster</button>

            <div id="reportResult" class="report-box" style="display:none;"></div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
// ==================== Firebase Config ====================
// BURAYI KENDÄ° CONFIG'Ä°NLE DEÄÄ°ÅTÄ°R !!!
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "your-project.firebaseapp.com",
    databaseURL: "https://your-project-default-rtdb.firebaseio.com",
    projectId: "your-project",
    storageBucket: "your-project.appspot.com",
    messagingSenderId: "123456789",
    appId: "1:123456789:web:abcdef123456"
};
// ========================================================

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let currentTeam = "";
let jobsRef = null;
let daysRef = null;

function login() {
    currentTeam = document.getElementById("teamCode").value.trim().toUpperCase();
    if (!currentTeam) return alert("Ekip kodu gir!");

    document.getElementById("loginScreen").style.display = "none";
    document.getElementById("app").style.display = "block";
    document.getElementById("teamName").textContent = currentTeam;

    jobsRef = db.ref("teams/" + currentTeam + "/jobs");
    daysRef = db.ref("teams/" + currentTeam + "/days");

    loadJobs();
}

function logout() {
    location.reload();
}

function showTab(n) {
    document.querySelectorAll('.tab button').forEach((b,i) => b.classList.toggle('active', i===n));
    document.querySelectorAll('.section').forEach((s,i) => s.classList.toggle('active', i===n));
}

// Ä°ÅŸ Ekle
function addJob() {
    const type = document.getElementById("jobType").value;
    let date = document.getElementById("jobDate").value;
    if (!date) date = new Date().toISOString().split('T')[0];

    const newJobRef = jobsRef.push();
    newJobRef.set({
        id: newJobRef.key,
        type: type,
        date: date,
        status: "Atanan",
        timestamp: Date.now()
    });

    alert("Ä°ÅŸ eklendi!");
}

// Ä°ÅŸleri YÃ¼kle
function loadJobs() {
    jobsRef.on("value", snapshot => {
        const tbody = document.querySelector("#jobsTable tbody");
        tbody.innerHTML = "";

        snapshot.forEach(child => {
            const job = child.val();
            const tr = document.createElement("tr");

            let statusClass = "";
            if (job.status === "YapÄ±lan") statusClass = "status-yap";
            else if (job.status === "Ertelenen") statusClass = "status-ert";
            else if (job.status === "Reklamasyon") statusClass = "status-rek";
            else statusClass = "status-at";

            tr.innerHTML = `
                <td>${job.date}</td>
                <td>${job.type}</td>
                <td class="${statusClass}">${job.status}</td>
                <td>
                    <button onclick="changeStatus('${job.id}', 'YapÄ±lan')">âœ” Tamamla</button>
                    <button onclick="changeStatus('${job.id}', 'Ertelenen')">â³ Ertele</button>
                    <button onclick="changeStatus('${job.id}', 'Reklamasyon')">âŒ Reklamasyon</button>
                    <button onclick="deleteJob('${job.id}')">ğŸ—‘ Sil</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    });
}

function changeStatus(jobId, newStatus) {
    jobsRef.child(jobId).update({ status: newStatus });
}

function deleteJob(jobId) {
    if (confirm("Bu iÅŸi silmek istediÄŸine emin misin?")) {
        jobsRef.child(jobId).remove();
    }
}

// Rapor
function generateReport() {
    const date = document.getElementById("reportDate").value;
    if (!date) return alert("Tarih seÃ§!");

    jobsRef.once("value").then(snapshot => {
        let total = 0, yapilan = 0, kalan = 0, ertelenen = 0, reklamasyon = 0;

        snapshot.forEach(child => {
            const j = child.val();
            if (j.date === date) {
                total++;
                if (j.status === "YapÄ±lan") yapilan++;
                else if (j.status === "Atanan") kalan++;
                else if (j.status === "Ertelenen") ertelenen++;
                else if (j.status === "Reklamasyon") reklamasyon++;
            }
        });

        daysRef.child(date).once("value").then(daySnap => {
            const dayData = daySnap.val() || { start: "??:??", end: "??:??" };

            const html = `
                <h2>${date} Raporu</h2>
                <p><strong>Kontak:</strong> ${dayData.start} / ${dayData.end}</p>
                <p><strong>Atanan Ä°ÅŸ:</strong> ${total}</p>
                <p><strong>YapÄ±lan:</strong> ${yapilan}</p>
                <p><strong>Kalan:</strong> ${kalan}</p>
                <p><strong>Ertelenen:</strong> ${ertelenen}</p>
                <p><strong>Reklamasyon:</strong> ${reklamasyon}</p>
                <hr>
                <small>Kontak saatini deÄŸiÅŸtirmek istersen aÅŸaÄŸÄ±dan dÃ¼zenle:</small><br>
                <input type="time" id="startTime" value="${dayData.start}">
                <input type="time" id="endTime" value="${dayData.end}">
                <button onclick="saveContact('${date}')">Kontak Kaydet</button>
            `;

            document.getElementById("reportResult").innerHTML = html;
            document.getElementById("reportResult").style.display = "block";
        });
    });
}

function saveContact(date) {
    const start = document.getElementById("startTime").value;
    const end = document.getElementById("endTime").value;
    daysRef.child(date).set({ start, end });
    alert("Kontak saatleri kaydedildi!");
}

// BugÃ¼nÃ¼n tarihini varsayÄ±lan yap
document.getElementById("jobDate").value = new Date().toISOString().split('T')[0];
document.getElementById("reportDate").value = new Date().toISOString().split('T')[0];
</script>
</body>
</html>